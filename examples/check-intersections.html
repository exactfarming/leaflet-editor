<!DOCTYPE html>
<html>
<head>
  <title>Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="../dist/css/index.css"/>
</head>
<body style="padding: 50px;">

<div id="map" style="float: right; width: 100%; height: 500px;"></div>

<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="../node_modules/leaflet/dist/leaflet-src.js"></script>
<script src="../dist/js/index.js"></script>
<script src="../dist/vendor/js/turf_kinks.min.js"></script>
<script src="https://npmcdn.com/@turf/turf@3.5.1/turf.min.js"></script>
<script>
  const _map = new LeafletEditor('map', {
    center: [54.521081495443596, 73.95996093749999],
    zoom: 4
  });

  let areaOfInterest;

  const checkSelfIntersections = function () {
    const geoJSON = _map.getEPolygon().toGeoJSON();

    console.log(geoJSON);

    if (_map.hasLayer(areaOfInterest)) {
      _map.removeLayer(areaOfInterest);
    }

    const jsonWithPoints = Object.assign({ type: 'FeatureCollection', features: [] }, turf.kinks(geoJSON));

    if (jsonWithPoints.features.length > 0) {
      areaOfInterest = L.geoJson(jsonWithPoints, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, {
            radius: 8,
            fillColor: "#ff3243",
            color: "#8c8c8c",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          });
        }
      }).addTo(_map);
    }

    console.log('turf.kinks', jsonWithPoints);
  };

  _map.on('editor:polygon:created', () => {
    console.log('polygon created');

    checkSelfIntersections();
  });
  _map.on('editor:polygon:hole_created', () => {
    console.log('hole created');

    checkSelfIntersections();
  });
  _map.on('editor:dragend_marker', () => {
    console.log('marker drag ended');

    checkSelfIntersections();
  });
  _map.on('editor:delete_marker', () => {
    console.log('marker deleted');

    checkSelfIntersections();
  });

</script>
</body>
</html>
